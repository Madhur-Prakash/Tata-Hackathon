<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Delhi to Amity Navigation</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        #map {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: 100%;
            z-index: 1;
        }


        .route-section {
            background: #fff3cd;
            border: 2px solid #ff6600;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .route-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .route-stats {
            display: flex;
            gap: 30px;
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            min-width: 100px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #ff6600;
        }

        .stat-label {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }

        button {
            padding: 12px 20px;
            background: #ff6600;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #e55a00;
        }

        .controls {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .status {
            padding: 10px;
            background: #f9f9f9;
            border-radius: 5px;
            font-family: monospace;
            font-size: 14px;
            margin-top: 10px;
        }

        .success {
            background: #e8f5e8;
            border-left: 4px solid #4caf50;
            color: #2e7d32;
        }

        .error {
            background: #ffebee;
            border-left: 4px solid #f44336;
            color: #c62828;
        }
    </style>
</head>
<body>        
        <div id="map"></div>
        
        <div class="controls">
        </div>
        
        <div class="status" id="statusDisplay">Click "Load Delhi to Amity Route" to begin</div>

    <script>
        // Global variables
        let map;
        let routeLayer = null;
        let startMarker = null;
        let endMarker = null;
        let userMarker = null;
        let currentLocation = null;
        let isNavigating = false;

        // Delhi to Amity University hardcoded route coordinates
        const startCoords = [28.6139, 77.2090]; // Delhi
        const endCoords = [28.5489, 77.3267];   // Amity University


        // Initialize map
        function initMap() {
            map = L.map('map').setView([28.6139, 77.2090], 12);
            
            L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; OpenStreetMap contributors'
            }).addTo(map);
            
            updateStatus("Map initialized. Ready to load route.", "success");
        }

        // Load the hardcoded Delhi to Amity route
        function loadDelhiToAmityRoute() {
    const startCoords = [28.6139, 77.2090]; // Delhi
    const endCoords = [28.5450, 77.2732];   // Amity University Noida

    const url = `https://router.project-osrm.org/route/v1/driving/${startCoords[1]},${startCoords[0]};${endCoords[1]},${endCoords[0]}?overview=full&geometries=geojson`;

    fetch(url)
        .then(res => res.json())
        .then(data => {
            if (data.code !== 'Ok') {
                throw new Error("Route not found");
            }

            const route = data.routes[0];

            // Remove old route if it exists
            if (window.routeLine) {
                map.removeLayer(window.routeLine);
            }

            // Draw new route in dark orange
            window.routeLine = L.geoJSON(route.geometry, {
                style: { color: '#ff6600', weight: 5 }
            }).addTo(map);

            // Remove existing markers if any
            if (startMarker) {
                map.removeLayer(startMarker);
            }
            if (endMarker) {
                map.removeLayer(endMarker);
            }

            // Create red marker icons
            const redMarkerIcon = L.icon({
            iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-red.png',
            shadowUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png',
            iconSize: [25, 41],
            iconAnchor: [12, 41],
            popupAnchor: [1, -34],
            shadowSize: [41, 41]
        });


        
        const distanceKm = (route.distance / 1000).toFixed(2);
        const durationMin = Math.round(route.duration / 60);
        
        // Add start and end markers
        startMarker = L.marker(startCoords, {icon: redMarkerIcon}).addTo(map).bindPopup("üìç Start: Delhi<br>Total Distance: " + distanceKm + " km<br>Duration: " + durationMin + " min").openPopup();
        endMarker = L.marker(endCoords, {icon: redMarkerIcon}).addTo(map).bindPopup("üèÅ End: Amity University<br>Total Distance: " + distanceKm + " km<br>Duration: " + durationMin + " min").openPopup();

        document.getElementById('routeSummary').innerHTML = `
                üöó Route Summary: <strong style="color: #ff6600;">${distanceKm} km</strong> 
                in <strong style="color: #ff6600;">${durationMin} minutes</strong>
            `;

            document.getElementById('routeStatus').textContent = 'Loaded';
            document.getElementById('startNavBtn').style.display = 'inline-block';

            updateStatus(`Route loaded! Distance: ${distanceKm} km, Time: ${durationMin} min`, "success");
        })
        .catch(err => {
            console.error("Error loading route:", err);
            document.getElementById('routeStatus').textContent = 'Error loading route';
            document.getElementById('routeSummary').innerHTML = `<span style="color: red;">‚ùå Failed to load route.</span>`;
            updateStatus("‚ùå Failed to load route", "error");
        });
}

        // Get current location
        function getCurrentLocation() {
            if (!navigator.geolocation) {
                updateStatus("Geolocation not supported", "error");
                return;
            }

            updateStatus("Getting your location...", "");

            navigator.geolocation.getCurrentPosition(
                function(position) {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    
                    currentLocation = { lat, lng };
                    
                    // Create blue car icon for user location
                    const carIcon = L.divIcon({
                        html: `<div style="
                            width: 30px; 
                            height: 30px; 
                            background: #2196f3; 
                            border: 3px solid white; 
                            border-radius: 50%; 
                            display: flex; 
                            align-items: center; 
                            justify-content: center; 
                            font-size: 16px; 
                            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
                        ">üöó</div>`,
                        iconSize: [30, 30],
                        iconAnchor: [15, 15]
                    });

                    // Remove existing user marker
                    if (userMarker) {
                        map.removeLayer(userMarker);
                    }

                    // Add user location marker
                    userMarker = L.marker([lat, lng], { icon: carIcon }).addTo(map);
                    userMarker.bindPopup('<b>üìç Your Location</b>').openPopup();
                    
                    map.setView([lat, lng], 15);
                    updateStatus(`Location found: ${lat.toFixed(5)}, ${lng.toFixed(5)}`, "success");
                },
                function(error) {
                    let message = "Location error: ";
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            message += "Permission denied";
                            break;
                        case error.POSITION_UNAVAILABLE:
                            message += "Position unavailable";
                            break;
                        case error.TIMEOUT:
                            message += "Request timeout";
                            break;
                        default:
                            message += "Unknown error";
                            break;
                    }
                    updateStatus(message, "error");
                },
                { enableHighAccuracy: true, timeout: 10000 }
            );
        }

        // Start navigation
        function startNavigation() {
            if (!routeLayer) {
                updateStatus("Please load the route first", "error");
                return;
            }

            if (isNavigating) {
                // Stop navigation
                isNavigating = false;
                document.getElementById('routeStatus').textContent = 'Loaded';
                document.getElementById('startNavBtn').textContent = 'üöÄ Start Navigation';
                document.getElementById('startNavBtn').style.background = '#4caf50';
                updateStatus("Navigation stopped.", "success");
            } else {
                // Start navigation
                isNavigating = true;
                document.getElementById('routeStatus').textContent = 'Navigating';
                document.getElementById('startNavBtn').textContent = 'üõë Stop Navigation';
                document.getElementById('startNavBtn').style.background = '#f44336';
                updateStatus("Navigation started! Follow the dark orange route to Amity University.", "success");
            }
        }

        // Clear route and markers
        function clearRoute() {
            if (routeLayer) {
                map.removeLayer(routeLayer);
                routeLayer = null;
            }
            if (startMarker) {
                map.removeLayer(startMarker);
                startMarker = null;
            }
            if (endMarker) {
                map.removeLayer(endMarker);
                endMarker = null;
            }
            
            document.getElementById('routeStatus').textContent = 'Ready';
            document.getElementById('startNavBtn').style.display = 'none';
            document.getElementById('startNavBtn').textContent = 'üöÄ Start Navigation';
            document.getElementById('startNavBtn').style.background = '#4caf50';
            isNavigating = false;
            
            updateStatus("Route cleared", "success");
        }

        // Update status display
        function updateStatus(message, type = "") {
            const statusElement = document.getElementById('statusDisplay');
            const timestamp = new Date().toLocaleTimeString();
            statusElement.textContent = `[${timestamp}] ${message}`;
            statusElement.className = `status ${type}`;
        }

        // Load Leaflet library dynamically and then initialize
        function loadLeaflet() {
            const script = document.createElement('script');
            script.src = 'https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.js';
            script.onload = function() {
                // Initialize map after Leaflet loads
                initMap();
                loadDelhiToAmityRoute();
            };
            script.onerror = function() {
                updateStatus("Failed to load map library", "error");
            };
            document.head.appendChild(script);
        }

        // Initialize when page loads
        window.onload = function() {
            updateStatus("Loading map library...", "");
            loadLeaflet();
        };
    </script>
</body>
</html>